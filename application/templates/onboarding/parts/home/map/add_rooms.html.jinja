<ul class="nav nav-tabs">
    {% for navfloor in current_user.active_home.floors %}
        <li class="nav-item">
            <a
                class="nav-link {% if navfloor.floor_id == floor.floor_id %}active{% endif %}"
                hx-get="/home/floor/edit/{{ navfloor.floor_id }}"
                hx-target="#onboarding-map"
            >
                {{ navfloor.floor_name }}</a
            >
        </li>
    {% endfor %}
</ul>

<h1>
    now editing: {{ floor.floor_name }} floor id: {{ floor.floor_id }} order:
    {{ floor.order }}
</h1>

<div
    class="container-fluid bg-dark border border-success border-5 rounded-bottom-5"
>
    <div id="types" class="row g-0 row-cols-4">
        <div>Living Room {{ floor.floor_id }} {{ floor.floor_name }} {{ floor.order }}</div>
        <div>Kitchen</div>
        <div>Dining Room</div>
        <div>Bedroom</div>
        <div>Bathroom</div>
        <div>Office/Study</div>
        <div>Laundry Room</div>
    </div>
</div>
<div
    id="room-list-container"
    class="container-fluid bg-dark border border-primary border-5 rounded-top-5"
>
    <div id="map" class="row g-0 row-cols-4">
        {% for room in floor.rooms | sort(attribute='order') %}
            <div>room type here</div>
            <div
                class="input-group mb-0"
                id="room-{{ room.room_id }}"
                data-id="{{ room.room_id }}"
            >
                <span
                    class="input-group-text"
                    id="floor-{{ floor.floor_id }}"
                    hx-get="/home/floor/rename/{{ floor.floor_id }}"
                    hx-target="this"
                    hx-swap="outerHTML"
                    hx-trigger="click"
                >
                    {{ room.room_name }}
                </span>
                <span class="input-group-text">({{ room.order }})</span>
                <button
                    hx-delete="/home/room/delete/{{ room.room_id }}"
                    hx-confirm="Are you sure you want to delete this room?"
                    hx-swap="outerHTML"
                    hx-target="#room-{{ room.room_id }}"
                    class="btn btn-danger"
                    type="button"
                >
                    Delete Floor
                </button>
            </div>
        {% endfor %}
    </div>
</div>

<script>
    const types = document.getElementById("types");
    const sortmap = document.getElementById("map");

    new Sortable(types, {
        group: {
            name: "shared",
            pull: "clone",
            put: false, // Do not allow items to be put into this list
        },
        animation: 150,
        sort: false,
        cursor: "move",
    });

    document.addEventListener("htmx:load", function () {
        new Sortable(sortmap, {
            group: {
                name: "shared",
                pull: true, // Prevent pulling from this list
            },
            animation: 150,
            ghostClass: "blue-background-class",
            filter: ".htmx-indicator",
            removeOnSpill: true, // Enable plugin
            // Called when item is spilled
            onSpill: function (/**Event*/ evt) {
                evt.item; // The spilled item
            },
            onAdd: function (/**Event*/ evt) {
                var itemEl = evt.item; // dragged HTMLElement
                var itemData = itemEl.innerHTML;

                // Make an htmx AJAX request to the server
                htmx.ajax("POST", "/home/map/room/add", {
                    values: { item_data: itemData },
                    target: itemEl,
                    swap: "outerHTML",
                });

                // Handle the response from the server
                htmx.on("htmx:afterRequest", function (evt) {
                    if (evt.detail.path === "/home/map/room/add") {
                        var responseData = evt.detail.xhr.response;

                        // Parse the response JSON
                        var newItemData = JSON.parse(responseData);

                        // Update the item element with the new data
                        itemEl.textContent = "Modified " + newItemData.name;
                        itemEl.setAttribute("id", newItemData.id);
                        itemEl.setAttribute(
                            "data-custom",
                            newItemData.data_custom,
                        );
                        itemEl.className = newItemData.class_name;
                    }
                });
            },
            onEnd: function () {
                var newOrder = Array.from(sortmap.children).map(
                    (li) => li.dataset.id,
                );
                htmx.ajax("POST", "/home/map/rooms", {
                    target: "#room-list-container",
                    swap: "innerHTML",
                    values: { order: newOrder },
                });
            },
        });
    });
</script>

<div
    class="container-fluid bg-primary-subtle border border-primary border-5 rounded-top-5"
>
    <div id="image-grid1" class="row g-0 row-cols-4">
        <div class="col">
            <img
                src="https://picsum.photos/1920/1080?random=1"
                alt="Image 1"
                class="img-fluid"
            />
        </div>
        <div class="col">
            <img
                src="https://picsum.photos/1920/1080?random=2"
                alt="Image 2"
                class="img-fluid"
            />
        </div>
        <div class="col">
            <img
                src="https://picsum.photos/1920/1080?random=3"
                alt="Image 3"
                class="img-fluid"
            />
        </div>
        <div class="col">
            <img
                src="https://picsum.photos/1920/1080?random=4"
                alt="Image 4"
                class="img-fluid"
            />
        </div>
        <div class="col">
            <img
                src="https://picsum.photos/1920/1080?random=5"
                alt="Image 5"
                class="img-fluid"
            />
        </div>
        <div class="col">
            <img
                src="https://picsum.photos/1920/1080?random=6"
                alt="Image 6"
                class="img-fluid"
            />
        </div>
        <div class="col">
            <img
                src="https://picsum.photos/1920/1080?random=7"
                alt="Image 7"
                class="img-fluid"
            />
        </div>
        <div class="col">
            <img
                src="https://picsum.photos/1920/1080?random=8"
                alt="Image 8"
                class="img-fluid"
            />
        </div>
        <div class="col">
            <img
                src="https://picsum.photos/1920/1080?random=9"
                alt="Image 9"
                class="img-fluid"
            />
        </div>
        <div class="col">
            <img
                src="https://picsum.photos/1920/1080?random=10"
                alt="Image 10"
                class="img-fluid"
            />
        </div>
        <div class="col">
            <img
                src="https://picsum.photos/1920/1080?random=11"
                alt="Image 11"
                class="img-fluid"
            />
        </div>
        <div class="col">
            <img
                src="https://picsum.photos/1920/1080?random=12"
                alt="Image 12"
                class="img-fluid"
            />
        </div>
        <div class="col">
            <img
                src="https://picsum.photos/1920/1080?random=13"
                alt="Image 13"
                class="img-fluid"
            />
        </div>
        <div class="col">
            <img
                src="https://picsum.photos/1920/1080?random=14"
                alt="Image 14"
                class="img-fluid"
            />
        </div>
        <div class="col">
            <img
                src="https://picsum.photos/1920/1080?random=15"
                alt="Image 15"
                class="img-fluid"
            />
        </div>
        <div class="col">
            <img
                src="https://picsum.photos/1920/1080?random=16"
                alt="Image 16"
                class="img-fluid"
            />
        </div>
    </div>
</div>

<div
    class="container-fluid bg-success-subtle border border-success border-5 rounded-bottom-5"
>
    <div id="map" class="row g-0 row-cols-4">
        <div>content to be replaced 1</div>
        <div>content to be replaced 2</div>
        <div>content to be replaced 3</div>
        <div>content to be replaced 4</div>
        <div>content to be replaced 5</div>
        <div>content to be replaced 6</div>
        <div>content to be replaced 7</div>
        <div>content to be replaced 8</div>
        <div>content to be replaced 9</div>
        <div>content to be replaced 10</div>
    </div>
</div>
